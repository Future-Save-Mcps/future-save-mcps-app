import{t as ne,r as l,a as de,j as e}from"./index-B7suXRWt.js";import{A as me}from"./AdminTableComponent-DqZWJYKu.js";import{D as oe,C as R,M as ie,d as ce}from"./MenuOpen-DF9EzJu0.js";import{S as pe}from"./Spinner-BPxFFULe.js";import{O as xe,L as ue}from"./LoanTabs-nmUOOETs.js";import{i as he,u as M}from"./logo-Dsqscvaz.js";import{f as ge}from"./formatDate-BNZwrLZe.js";import{f as r}from"./currencyFormatter-BEPJfsmg.js";import{u as ye,F as c,C as fe,a as je}from"./index.esm-DQuZ_ALP.js";import{g as V}from"./weeksOptionGenerator-XSfyeZ1H.js";import"./utils-B2YjnSsP.js";import"./button-QOzlOHZZ.js";import"./AdminRoutes-Cwd2UEVZ.js";import"./floating-ui.react-dom-CE18VVHP.js";import"./dropdown-menu-B1iEN1XF.js";import"./formatTimeAgo-CnVqMwlt.js";const ve={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95vw",bgcolor:"white",border:"none",outline:"none",p:3,maxWidth:"500px",borderRadius:"20px"},He=()=>{var j,v,N,k,b,w,A,C,S,F,T,W,D,I,L,O,B,$,q,E;const[G,Ne]=ne(),[P,z]=l.useState(!1),[n,ke]=l.useState(G.get("id")),H=de(),[Y,p]=l.useState(!1),[be,x]=l.useState(null),{post:we,isLoading:u}=he(),{register:d,handleSubmit:_,control:J,setValue:m,watch:o,formState:{errors:t},reset:Ae}=ye();o("savingsPlan","25");const h=o("paymentType","CurrentWeekPayment"),g=o("Weeks",""),K=async s=>{console.log(s),s.weeklyAmount,s.paymentType};l.useEffect(()=>{n&&z(!0)},[n]);const Q=s=>{window.location.href=`/admin/savings_management?id=${s}`},{data:i,isLoading:y,refetch:Ce}=M("admin/savings/all?PageNumber=1&PageSize=100"),{data:a,isLoading:Se,isFetching:U,refetch:Fe}=M(`savingsplan?PlanId=${n}`);console.log("loanPlan",a);const X=[{label:"Name",value:"fullName"},{label:"Contribution Plans",value:"durationInWeeks"},{label:"Target Amount",value:"targetAmount"},{label:"Date Created",value:"startDate"},{label:"Weekly Amount",value:"weeklyAmount"},{label:"Account Status",value:"planStatus"}],Z=(v=(j=i==null?void 0:i.data)==null?void 0:j.items)==null?void 0:v.map(s=>({...s,id:s.planId,startDate:ge(s.startDate),durationInWeeks:s.durationInWeeks+" Weeks",targetAmount:r(s.targetAmount),weeklyAmount:r(s.weeklyAmount),planStatus:e.jsxs("span",{className:`px-3 py-1 flex w-fit items-center gap-2 rounded-2xl  ${s.planStatus==="completed"?"bg-[#34C7591F]  text-[#34C759]":s.planStatus==="Rejected"?"bg-[#FB03001F]  text-[#FB0300]":"bg-[#FF790C1F]  text-[#FF790C]"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.planStatus==="completed"?"bg-[#34C759]":s.planStatus==="Rejected"?"bg-[#FB0300]":"bg-[#FF790C]"}`})," ",s.planStatus]})})),ee=s=>{p(!0),x(s)},f=()=>{p(!1),x(null)},ae=(s,re)=>{console.log(s)},se=(s,re)=>{console.log("this is the filter")},te=()=>{console.log("Exporting data...")},le=()=>{console.log("Viewing audit trail...")};return e.jsxs("div",{children:[e.jsx(me,{headers:X,data:Z,onSearch:ae,onFilter:se,onExport:te,onAuditTrail:le,view:Q,loading:y}),e.jsx(oe,{anchor:"right",open:P,children:e.jsxs("div",{className:" w-[100vw] relative max-w-[700px]",children:[e.jsxs("div",{className:" p-4  bg-white  sticky top-0 flex justify-between mb-8 items-center ",children:[e.jsx("h2",{className:"text-[24px] font-[700]",children:"Plan Details"}),e.jsx(R,{onClick:()=>H(-1),sx:{cursor:"pointer",padding:"5px",width:"35px",height:"35px",borderRadius:"50%",backgroundColor:"#F8F8FA"}})]}),e.jsx("div",{className:"p-4",children:y||U?e.jsx(pe,{}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{cardTitle:((N=a==null?void 0:a.data)==null?void 0:N.planName)||"test plan",contrubutionBalance:`â‚¦ ${(k=a==null?void 0:a.data)==null?void 0:k.currentBalance}`,contributionWeekPlan:`${(b=a==null?void 0:a.data)==null?void 0:b.durationInWeeks} weeks Plan`,status:(w=a==null?void 0:a.data)==null?void 0:w.planStatus,remainingDays:` ${(A=a==null?void 0:a.data)==null?void 0:A.daysRemaining} days remaining`,percentage:((C=a==null?void 0:a.data)==null?void 0:C.planStatus)==="completed"?100:((S=a==null?void 0:a.data)==null?void 0:S.currentBalance)<1?0:((F=a==null?void 0:a.data)==null?void 0:F.currentBalance)/((T=a==null?void 0:a.data)==null?void 0:T.targetAmount)*100}),e.jsx("div",{className:"flex justify-center flex-wrap gap-4 items-center",children:e.jsxs("button",{onClick:()=>ee("Approval"),className:"flex justify-center min-w-[200px] mt-4 items-center gap-4 px-6 py-3 rounded-xl text-[#fff] bg-primary ",children:[" ",e.jsx("span",{className:"text-3xl font-mono",children:"+"})," Make Offline Payment"]})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Personal Info"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Name"})," ",(W=a==null?void 0:a.data)==null?void 0:W.fullName]}),e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Email"})," ",(D=a==null?void 0:a.data)==null?void 0:D.emailAddress]}),e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Phone No"})," ",(I=a==null?void 0:a.data)==null?void 0:I.phoneNumber]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Plan Info"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Weekly Repayment"})," ",r((L=a==null?void 0:a.data)==null?void 0:L.weeklyAmount)]}),e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Target Amount"}),r((O=a==null?void 0:a.data)==null?void 0:O.targetAmount)]}),e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Start Date"})," ",(B=a==null?void 0:a.data)==null?void 0:B.startDate]}),e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"End Date"})," ",($=a==null?void 0:a.data)==null?void 0:$.endDate]}),e.jsxs("p",{className:" flex flex-col",children:[e.jsx("strong",{children:"Dividend"})," ",r((q=a==null?void 0:a.data)==null?void 0:q.dividends)]})]})]})]}),e.jsx(ue,{activities:(E=a==null?void 0:a.data)==null?void 0:E.activities})]})})]})}),e.jsx(ie,{open:Y,onClose:f,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ce,{sx:ve,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Offline Payment"}),e.jsx(R,{onClick:f,sx:{cursor:"pointer",padding:"5px",width:"35px",height:"35px",borderRadius:"50%",backgroundColor:"#F8F8FA"}})]}),e.jsxs("form",{className:" overflow-auto max-h-[80dvh]",onSubmit:_(K),children:[e.jsx(c,{label:"Offline Payment Type",name:"Type",type:"select",setValue:m,register:d,validation:{required:"Paymemt Type is required"},options:V(25),errors:t}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-primary mb-2",children:"Payment Type"}),e.jsx(fe,{name:"paymentType",control:J,defaultValue:"CurrentWeekPayment",rules:{required:"payment type is required"},render:({field:s})=>e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:`flex items-center space-x-2 flex-1 p-3 rounded-md border ${s.value==="CurrentWeekPayment"?"border-primary":"border-gray-300"}`,children:[e.jsx("input",{...s,type:"radio",value:"CurrentWeekPayment",checked:s.value==="CurrentWeekPayment",className:"w-4 h-4 text-primary border-gray-300 focus:ring-primary"}),e.jsx("span",{children:"This week payment"})]}),e.jsxs("label",{className:`flex items-center space-x-2 flex-1 p-3 rounded-md border ${s.value==="AdvancePayment"?"border-primary":"border-gray-300"}`,children:[e.jsx("input",{...s,type:"radio",value:"AdvancePayment",checked:s.value==="AdvancePayment",className:"w-4 h-4 text-primary border-gray-300 focus:ring-primary"}),e.jsx("span",{children:"Advance Payment "})]})]})}),t.paymentType&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.paymentType.message})]}),h==="AdvancePayment"&&e.jsx(c,{label:"Number of weeks (25 weeks Plan)",name:"Weeks",type:"select",setValue:m,register:d,validation:{required:"Number of weeks is required"},options:V(25),errors:t}),e.jsx(c,{label:"Weekly Amount (Your weekly payment is NGN 5000.00)",name:"weeklyAmount",type:"number",big:!0,readOnly:!0,placeholder:"5000",register:d,defaultValueAttachment:g===""||h==="CurrentWeekPayment"?5e3:5e3*g,setValue:m,validation:{required:"Weekly amount is required",min:{value:5e3,message:"Amount must be at least NGN 5000.00"}},errors:t}),e.jsx(je,{width:"100%",type:"submit",text:"Make payment",isLoading:u,disabled:u})]})]})})]})};export{He as default};
